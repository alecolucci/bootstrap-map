
/**
 * Dependencies
 */

var geocode = require('mapquest').geocode;

/**
 * Expose `search`
 */

module.exports = function(service, address, radius, all, callback) {
  geocode(address, function(err, data) {
    if (err) {
      callback(err);
    } else {
      var serviceName = service.toLowerCase()
        , find = require('./services/' + serviceName)
        , lat = data.latLng.lat
        , lng = data.latLng.lng
        , parsedAddress = {
            street: data.street
          , zip: parseInt(data.postalCode, 10)
          , city: data.adminArea5
          , state: data.adminArea3 || data.adminArea4
          };

      if (serviceName === 'opentable') {
        find(parsedAddress, all, callback);
      } else {
        find(lat, lng, radius, all, callback);
      }
    }
  });
};
